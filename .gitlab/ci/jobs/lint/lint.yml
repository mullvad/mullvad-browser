lint-all:
  extends: .with-local-repo-bash
  stage: lint
  image: $IMAGE_PATH
  interruptible: true
  variables:
    # Has to be the same as defined in `containers/base/Containerfile`
    MOZBUILD_STATE_PATH: "/var/tmp/mozbuild"
  cache:
    paths:
      - node_modules
    # Store the cache regardless on job outcome
    when: 'always'
    # Share the cache throughout all pipelines running for a given branch
    key: $CI_COMMIT_REF_SLUG
  tags:
    # Run these jobs in the browser dedicated runners.
    - firefox
  script:
    - ./mach configure --with-base-browser-version=0.0.0
    - .gitlab/ci/jobs/lint/helpers.py --get-changed-files | xargs -0 --no-run-if-empty ./mach lint -v
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
    # Run job whenever a commit is merged to a protected branch
    - if: ($CI_COMMIT_BRANCH && $CI_COMMIT_REF_PROTECTED == 'true' && $CI_PIPELINE_SOURCE == 'push')
